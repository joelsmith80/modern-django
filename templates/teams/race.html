<!-- templates/teams/race.html -->

{% extends 'base.html' %}

{% block title %}{{ race.name }}{% endblock %}

{% block content %}

<section class="race-marquee {{ race.slug }}">
  <div class="wrap">
    <div class="intro">
      <h1 class="title">{{ race.name }}</h1>
      <p class="dateline">{{ race.starts }}</p>
      <p>{{ race.description }}</p>
    </div>
    <div class="map">
      <a href="#" target="_blank" rel="noopener">View Map</a>
    </div>
    <div class="distance">
      {{ race.distance }}
    </div>
    <div class="start-city map-point">
      {{ race.start_city }}
    </div>
    <div class="end-city map-point">
      {{ race.end_city }}
    </div>
  </div>
</section>

<section class="team-mgmt-section">
    <div class="wrap">
        <header class="region">
            <h1><a href="{% url 'races:team_show' team.id %}">{{ team.name }}</a></h1>
            {% if team.league %}
                <p><a href="{% url 'races:league_show' team.league.id %}">{{ team.league }}</a></p>
            {% else %}
                <p>Your team won't be able to race unless you <a href="{% url 'races:team_join_league' team.id %}">join a league</a>.</p>
            {% endif %}
            {% if team_belongs_to_user %}
                <p>This is your team, so we'll show you some management options.</p>
                {% if not race.is_locked %}
                  {% if race.has_roster %}
                    <a href="{% url 'races:team_race_draft' id=team.id slug=race.slug %}">Edit Roster</a>
                  {% else %}
                  <a href="{% url 'races:team_race_draft' id=team.id slug=race.slug %}">Draft a Team</a>
                  {% endif %}
                {% endif %}
            {% else %}
                <p>This isn't your team, so we'll display only public information.</p>
            {% endif %}
        </header>
    </div>
</section>

<section>
  <div class="wrap">
    <header class="section-header region">
      <h2 class="section-title">{{ messages.table_hed }}</h2>
    </header>
    <div class="section-content region">
      
      {% if race.has_results %}

        <div class="race-results" data-ui="tabs">

          <nav>
            <ul>
              <li><a href="#team-panel">Team</a></li>
              <li><a href="#overall-panel">Overall</a></li>
            </ul>
          </nav>
          
          <div id="team-panel" class="panel team">
            <h3>Team Results</h3>
            {% if team_results in rows %}
              {% include "teams/race-table-team-results.html" %}
            {% else %}
              <p class="empty-results-explanation">{{ messages.no_team_results }}</p>
            {% endif %}
          </div>
          
          <div id="overall-panel" class="panel overall">
            <h3>Overall Results</h3>
            {% if 'overall_results' in rows %}
              {% include "teams/race-table-overall-results.html" %}
            {% else %}
              <p class="empty-results-explanation">{{ messages.no_overall_results }}</p>
            {% endif %}
          </div>

        </div>
      
      {% else %}

        {% if team_belongs_to_user %}
        
          {% if roster %}

            {% include "teams/race-table-team-roster-ready.html" %}

          {% else %}

            {% if picks %}

              {% include "teams/form-draft.html" %}

            {% else %}
            
              <p class="empty-results-explanation">{{ messages.no_participants }}</p>

            {% endif %}

          {% endif %}

        {% else %}
          <p>{{ messages.no_results_for_this_team }}</p>
        {% endif %}

      {% endif %}
    </div>
  </div>
</section>

{% endblock %}